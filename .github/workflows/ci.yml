name: CI

on:
  push:
    branches-ignore: wip
    paths:
      - '.github/workflows/ci.yml'
      - 'package.json'
      - 'patches/*.patch.toml'
  pull_request:

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup
        run: npm i -D --no-fund
      - name: Lint
        run: npx eslint patches/*.patch.toml
  workflow_dispatch:
    if: |
      github.event_name  == 'push' &&
      github.ref == 'refs/heads/main' &&
      github.repository == 'xenia-canary/game-patches'
    needs: lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          repository: xenia-canary/xenia-canary.github.io
      - name: Workflow dispatch
        env:
          GITHUB_TOKEN: ${{ secrets.WORKFLOW }}
        run: gh workflow run jekyll.yml
